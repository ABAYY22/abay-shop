<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abay Studio | All-in-One Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700;800&display=swap');
        body { background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; scroll-behavior: smooth; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .tab-content { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-tab.active { background: #2563eb; color: white; border-color: #2563eb; }
        .admin-only { display: none; }
        .is-admin .admin-only { display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        #ai-window, #playlist-window { transition: all 0.3s; transform: translateY(20px); opacity: 0; pointer-events: none; visibility: hidden; }
        #ai-window.active, #playlist-window.active { transform: translateY(0); opacity: 1; pointer-events: auto; visibility: visible; }
        .gemini-gradient { background: linear-gradient(90deg, #4285f4, #9b72cb, #d96570); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="bg-black text-white antialiased">

    <button onclick="loginAdmin()" class="fixed top-4 right-4 z-50 text-[8px] opacity-20 hover:opacity-100 uppercase font-bold">Admin</button>

    <section class="pt-10 pb-6 px-6">
        <div class="max-w-4xl mx-auto glass p-8 rounded-[2.5rem] flex flex-col md:flex-row gap-8 items-center">
            <div class="relative group">
                <img id="p-foto" src="https://ui-avatars.com/api/?name=Abay" class="w-32 h-32 md:w-40 md:h-40 rounded-[2rem] object-cover border-2 border-white/10 shadow-2xl">
                <button onclick="editProfile('foto')" class="admin-only absolute inset-0 bg-black/50 rounded-[2rem] flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><i class="fas fa-camera text-xl"></i></button>
            </div>
            <div class="text-center md:text-left flex-1">
                <div class="flex items-center justify-center md:justify-start gap-2">
                    <h1 id="p-nama" class="text-4xl font-black uppercase tracking-tighter text-blue-500">Abay Studio</h1>
                    <button onclick="editProfile('nama')" class="admin-only text-xs opacity-50"><i class="fas fa-edit"></i></button>
                </div>
                <p id="p-bio" onclick="editProfile('bio')" class="text-xs opacity-50 font-bold tracking-widest uppercase mt-1 mb-4 cursor-pointer">Waiting For You</p>
                <div class="grid grid-cols-2 gap-3 text-[10px] uppercase font-bold text-center">
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5 cursor-pointer" onclick="editProfile('hobi')"><span class="opacity-40 block">Hobi</span><span id="p-hobi">-</span></div>
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5 cursor-pointer" onclick="editProfile('skill')"><span class="opacity-40 block">Skill</span><span id="p-skill">-</span></div>
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5 cursor-pointer" onclick="editProfile('sekolah')"><span class="opacity-40 block">Sekolah</span><span id="p-sekolah">-</span></div>
                    <div class="bg-white/5 p-2 rounded-xl border border-white/5 cursor-pointer" onclick="editProfile('alamat')"><span class="opacity-40 block">Alamat</span><span id="p-alamat">-</span></div>
                </div>
            </div>
        </div>
    </section>

    <nav class="sticky top-0 z-40 bg-black/80 backdrop-blur-xl py-4 border-y border-white/5 mb-10">
        <div class="flex justify-center gap-3 px-4 overflow-x-auto no-scrollbar">
            <button onclick="openTab('stories')" class="nav-tab active px-6 py-3 rounded-2xl text-[10px] font-bold uppercase tracking-widest transition border border-white/10">Stories</button>
            <button onclick="openTab('tools')" class="nav-tab px-6 py-3 rounded-2xl text-[10px] font-bold uppercase tracking-widest transition border border-white/10">Tools</button>
            <button onclick="openTab('shop')" class="nav-tab px-6 py-3 rounded-2xl text-[10px] font-bold uppercase tracking-widest transition border border-white/10">Shop</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 pb-48">
        <div id="stories" class="tab-content active">
            <button onclick="addStory()" class="admin-only w-full mb-6 border-2 border-dashed border-white/10 p-4 rounded-2xl text-[10px] uppercase font-bold opacity-50 hover:opacity-100">+ Tambah Story</button>
            <div id="story-list" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>
        
        <div id="tools" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass p-8 rounded-[2.5rem] border-l-4 border-red-500">
                    <h3 class="font-black uppercase mb-2 flex items-center gap-2 text-sm"><i class="fab fa-tiktok"></i> TikTok Downloader</h3>
                    <input id="dl-url" type="text" placeholder="Link TikTok..." class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl text-xs mb-4 text-white outline-none">
                    <button onclick="downloadVideo()" class="w-full bg-white text-black py-4 rounded-2xl font-black text-[10px] uppercase">Download</button>
                </div>
                <div class="glass p-8 rounded-[2.5rem] border-l-4 border-blue-500">
                    <h3 class="font-black uppercase mb-2 flex items-center gap-2 text-sm"><i class="fas fa-link"></i> Link Generator</h3>
                    <input type="file" id="file-input" class="hidden" onchange="uploadFile()">
                    <button onclick="document.getElementById('file-input').click()" class="w-full bg-blue-600 py-4 rounded-2xl font-black text-[10px] uppercase">Upload File</button>
                    <div id="upload-status" class="mt-4 text-center text-[10px] font-bold break-all text-blue-400"></div>
                </div>
            </div>
        </div>

        <div id="shop" class="tab-content">
            <button onclick="addProduct()" class="admin-only w-full mb-6 border-2 border-dashed border-white/10 p-4 rounded-2xl text-[10px] uppercase font-bold opacity-50 hover:opacity-100">+ Tambah Produk</button>
            <div id="product-list" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>
    </main>

    <div id="playlist-window" class="fixed bottom-28 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-[#161616] glass rounded-[2rem] z-[101] p-6 shadow-2xl overflow-hidden">
        <div class="flex justify-between items-center mb-4">
            <span class="text-xs font-bold uppercase tracking-widest text-blue-500">Daftar Musik</span>
            <button onclick="togglePlaylist()"><i class="fas fa-times opacity-30"></i></button>
        </div>
        <div id="playlist-list" class="max-h-[300px] overflow-y-auto space-y-2 no-scrollbar">
            </div>
    </div>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[90] w-[90%] max-w-md">
        <div class="glass p-4 rounded-3xl flex items-center gap-4 border-white/10 shadow-2xl">
            <button onclick="togglePlaylist()" class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-white/10">
                <i class="fas fa-list-ul text-xs"></i>
            </button>
            <div class="flex-1 overflow-hidden">
                <div id="track-title" class="text-[9px] font-bold uppercase truncate">Memilih Lagu...</div>
                <div class="flex items-center gap-3 mt-1">
                    <button onclick="prevTrack()"><i class="fas fa-step-backward text-[10px]"></i></button>
                    <button id="play-btn" onclick="togglePlay()"><i class="fas fa-play text-[10px]"></i></button>
                    <button onclick="nextTrack()"><i class="fas fa-step-forward text-[10px]"></i></button>
                </div>
            </div>
            <button onclick="addMusic()" class="admin-only bg-blue-600/20 w-8 h-8 rounded-lg flex items-center justify-center">
                <i class="fas fa-plus text-[10px]"></i>
            </button>
            <audio id="audio-player"></audio>
        </div>
    </div>

    <div id="ai-toggle" onclick="toggleAI()" class="fixed bottom-6 right-6 w-14 h-14 bg-[#1a1a1a] rounded-2xl flex items-center justify-center z-[100] border border-white/10">
        <i class="fas fa-robot text-blue-500"></i>
    </div>
    <div id="ai-window" class="fixed bottom-24 right-6 w-[92%] md:w-[400px] h-[70vh] bg-[#0f0f0f] rounded-[2rem] flex flex-col z-[101] border border-white/10 overflow-hidden shadow-2xl">
        <div class="p-6 border-b border-white/5 bg-[#161616] flex justify-between items-center text-sm font-bold gemini-gradient italic">Gemini Abay Studio <button onclick="toggleAI()"><i class="fas fa-times text-white/30"></i></button></div>
        <div id="ai-messages" class="flex-1 p-6 overflow-y-auto flex flex-col space-y-4 no-scrollbar"></div>
        <div class="p-4 bg-[#161616] border-t border-white/5 flex gap-2">
            <input id="ai-input" type="text" placeholder="Tanya sesuatu..." class="flex-1 bg-[#2b2b2b] rounded-xl px-4 py-3 text-sm outline-none" onkeypress="if(event.key === 'Enter') askAI()">
            <button onclick="askAI()" class="text-blue-500"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        const dbUrl = "https://toko-49a45-default-rtdb.firebaseio.com/";
        const GEMINI_KEY = "AIzaSyDjanGkO1X_oy8QMETuASpBUMsybzYviTE"; 
        let isAdmin = false;
        let tracks = [];
        let currentTrackIdx = 0;
        const player = document.getElementById('audio-player');

        window.onload = () => { loadData(); loadStories(); loadProducts(); loadMusic(); };

        function loginAdmin() {
            Swal.fire({ title: 'Admin Login', input: 'password' }).then((res) => {
                if(res.value === 'abayganteng') { 
                    isAdmin = true;
                    document.body.classList.add('is-admin');
                    Swal.fire('Admin Aktif!', '', 'success');
                    loadStories(); loadProducts(); loadMusic();
                }
            });
        }

        // --- MUSIC PLAYER LOGIC ---
        async function loadMusic() {
            const r = await fetch(dbUrl + "music.json");
            const d = await r.json();
            tracks = [];
            const listC = document.getElementById('playlist-list');
            listC.innerHTML = '';
            
            for(let id in d) {
                const track = { ...d[id], id };
                tracks.push(track);
                
                // Create Playlist Item
                const item = document.createElement('div');
                item.className = "flex justify-between items-center bg-white/5 p-3 rounded-xl hover:bg-white/10 cursor-pointer transition";
                item.innerHTML = `
                    <div class="flex-1" onclick="selectTrack(${tracks.length-1})">
                        <p class="text-[10px] font-bold uppercase truncate">${track.title}</p>
                    </div>
                    ${isAdmin ? `<button onclick="deleteData('music/${id}')" class="text-red-500 text-[10px] ml-2"><i class="fas fa-trash"></i></button>` : ''}
                `;
                listC.appendChild(item);
            }
            if(tracks.length > 0) setupMusic(0);
        }

        function setupMusic(i) {
            currentTrackIdx = i;
            player.src = tracks[i].url;
            document.getElementById('track-title').innerText = tracks[i].title;
        }

        function selectTrack(i) {
            setupMusic(i);
            togglePlaylist();
            togglePlay(true);
        }

        function togglePlay(forcePlay = false) {
            const btn = document.getElementById('play-btn');
            if(player.paused || forcePlay) { 
                player.play(); 
                btn.innerHTML = '<i class="fas fa-pause text-[10px]"></i>'; 
            } else { 
                player.pause(); 
                btn.innerHTML = '<i class="fas fa-play text-[10px]"></i>'; 
            }
        }

        function nextTrack() { currentTrackIdx = (currentTrackIdx + 1) % tracks.length; setupMusic(currentTrackIdx); player.play(); }
        function prevTrack() { currentTrackIdx = (currentTrackIdx - 1 + tracks.length) % tracks.length; setupMusic(currentTrackIdx); player.play(); }
        function togglePlaylist() { document.getElementById('playlist-window').classList.toggle('active'); }

        async function addMusic() {
            const { value: m } = await Swal.fire({
                title: 'Lagu Baru',
                html: '<input id="m-t" class="swal2-input" placeholder="Judul"><input id="m-u" class="swal2-input" placeholder="URL mp3">',
                preConfirm: () => ({ title: document.getElementById('m-t').value, url: document.getElementById('m-u').value })
            });
            if(m.title && m.url) { await fetch(`${dbUrl}music.json`, { method: 'POST', body: JSON.stringify(m) }); loadMusic(); }
        }

        // --- MANAJEMEN DATA ---
        async function editProfile(field) {
            if(!isAdmin) return;
            const { value: newVal } = await Swal.fire({ title: `Ganti ${field}`, input: 'text' });
            if(newVal) { await fetch(`${dbUrl}hero/${field}.json`, { method: 'PUT', body: JSON.stringify(newVal) }); loadData(); }
        }

        async function addStory() {
            const { value: form } = await Swal.fire({
                title: 'Story Baru',
                html: '<input id="s-t" class="swal2-input" placeholder="Judul"><textarea id="s-c" class="swal2-textarea" placeholder="Isi"></textarea>',
                preConfirm: () => ({ title: document.getElementById('s-t').value, content: document.getElementById('s-c').value })
            });
            if(form.title) { await fetch(`${dbUrl}stories.json`, { method: 'POST', body: JSON.stringify(form) }); loadStories(); }
        }

        async function addProduct() {
            const { value: f } = await Swal.fire({
                title: 'Produk Baru',
                html: '<input id="p-n" class="swal2-input" placeholder="Nama"><input id="p-h" class="swal2-input" placeholder="Harga"><input id="p-g" class="swal2-input" placeholder="Gambar"><input id="p-w" class="swal2-input" placeholder="WhatsApp">',
                preConfirm: () => ({ name: document.getElementById('p-n').value, price: document.getElementById('p-h').value, image: document.getElementById('p-g').value, whatsapp: document.getElementById('p-w').value })
            });
            if(f.name) { await fetch(`${dbUrl}products.json`, { method: 'POST', body: JSON.stringify(f) }); loadProducts(); }
        }

        async function deleteData(path) {
            if(confirm('Hapus?')) { await fetch(`${dbUrl}${path}.json`, { method: 'DELETE' }); location.reload(); }
        }

        // --- TOOLS & LOAD ---
        async function downloadVideo() {
            const url = document.getElementById('dl-url').value;
            if(!url) return;
            Swal.fire({ title: 'Mencari...', didOpen: () => Swal.showLoading() });
            try {
                const res = await fetch(`https://api.cloudhostid.biz.id/tiktok/dl?url=${url}`);
                const d = await res.json();
                window.open(d.result.url_nowm, '_blank');
                Swal.close();
            } catch(e) { Swal.fire('Error', '', 'error'); }
        }

        async function uploadFile() {
            const fi = document.getElementById('file-input');
            const st = document.getElementById('upload-status');
            if(!fi.files[0]) return;
            st.innerText = "⏳ Uploading...";
            const fd = new FormData(); fd.append('file', fi.files[0]);
            const r = await fetch('https://tmpfiles.org/api/v1/upload', { method: 'POST', body: fd });
            const d = await r.json();
            const link = d.data.url.replace("tmpfiles.org/", "tmpfiles.org/dl/");
            st.innerHTML = `✅ Link: <a href="${link}" target="_blank" class="underline">${link}</a>`;
        }

        async function loadData() {
            const r = await fetch(dbUrl + "hero.json"); const h = await r.json();
            if(h) { 
                document.getElementById('p-nama').innerText = h.nama || 'Abay Studio';
                document.getElementById('p-bio').innerText = h.bio || 'Waiting For You';
                document.getElementById('p-foto').src = h.foto || '';
                document.getElementById('p-hobi').innerText = h.hobi || '-';
                document.getElementById('p-skill').innerText = h.skill || '-';
                document.getElementById('p-sekolah').innerText = h.sekolah || '-';
                document.getElementById('p-alamat').innerText = h.alamat || '-';
            }
        }

        async function loadStories() {
            const r = await fetch(dbUrl + "stories.json"); const d = await r.json();
            const c = document.getElementById('story-list'); c.innerHTML = '';
            for(let id in d) {
                c.innerHTML += `<div class="glass p-6 rounded-[2rem] relative">
                    ${isAdmin ? `<button onclick="deleteData('stories/${id}')" class="absolute top-4 right-4 text-red-500"><i class="fas fa-trash"></i></button>` : ''}
                    <h3 class="font-bold uppercase text-blue-500">${d[id].title}</h3>
                    <p class="text-[10px] opacity-40 mt-3">${d[id].content}</p>
                </div>`;
            }
        }

        async function loadProducts() {
            const r = await fetch(dbUrl + "products.json"); const d = await r.json();
            const c = document.getElementById('product-list'); c.innerHTML = '';
            for(let id in d) {
                c.innerHTML += `<div class="glass p-4 rounded-3xl text-center relative">
                    ${isAdmin ? `<button onclick="deleteData('products/${id}')" class="absolute top-2 right-2 text-red-500 z-10"><i class="fas fa-times-circle"></i></button>` : ''}
                    <img src="${d[id].image}" class="w-full h-32 object-cover rounded-2xl mb-3">
                    <h4 class="text-[10px] font-bold truncate uppercase">${d[id].name}</h4>
                    <p class="text-blue-500 font-black text-xs my-2">Rp ${d[id].price}</p>
                    <a href="https://wa.me/${d[id].whatsapp}" class="block bg-white text-black py-2 rounded-xl text-[8px] font-bold uppercase">Beli</a>
                </div>`;
            }
        }

        function toggleAI() { document.getElementById('ai-window').classList.toggle('active'); }
        async function askAI() {
            const i = document.getElementById('ai-input'); const b = document.getElementById('ai-messages');
            const m = i.value.trim(); if(!m) return;
            b.innerHTML += `<div class="user-bubble p-4 text-sm text-white ml-auto max-w-[85%]">${m}</div>`; i.value = '';
            const res = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${GEMINI_KEY}`, {
                method: 'POST', body: JSON.stringify({ contents: [{ parts: [{ text: m }] }] })
            });
            const d = await res.json();
            b.innerHTML += `<div class="ai-bubble p-4 text-sm text-gray-200 max-w-[85%]">${d.candidates[0].content.parts[0].text}</div>`;
            b.scrollTop = b.scrollHeight;
        }

        function openTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
